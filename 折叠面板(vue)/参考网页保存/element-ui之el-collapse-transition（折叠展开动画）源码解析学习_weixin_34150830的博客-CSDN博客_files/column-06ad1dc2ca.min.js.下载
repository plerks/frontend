$(function(){function e(){var e=setInterval(function(){if(document.getElementById("csdn-toolbar")){clearInterval(e),d=document.getElementById("csdn-toolbar").offsetHeight;var a=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop;a-l>0&&a<o-s&&s>0?t.css({position:"fixed","z-index":"999",left:n+"px",top:d,width:c}):t.css({position:"unset","z-index":"10",left:"0px",top:"0",width:c})}},100)}var a=window.location.href;if(a.indexOf("category_")>-1){var t=$("#column .column_info_box"),o=$("#column .column_article_list").height(),s=$("#column .column_article_list li").length?$("#column .column_article_list li").height():0,i=document.getElementsByTagName("main")[0],n=i.offsetLeft,c=i.offsetWidth,l=document.getElementsByTagName("header")[0].offsetHeight,d=0;e(),$(window).scroll(function(){e()}),$(window).resize(function(){n=i.offsetLeft,c=i.offsetWidth,e()})}}),$(function(){function e(){x="https://csdnimg.cn/release/download/images/pay_error.png",w="已扫码<br>请在手机端操作",$("#payCode").html('<div class="renovate"><img src="'+x+'"><span>'+w+"</span></div>"),$("#payCodeImg").html('<img class="repeat-again" src="'+x+'"><span class="text">'+w+"</span>")}function a(a){var n={goods_id:a,product_id:a,flag:17,request_type:4,is_use_balance:r,coupon_key:m,success_function:t,error_function:s,timeout_function:i,get_pay_success_callback:o,payment_function:e};$("#payCode").html(k),$("#payCodeImg").html(_),cart.qrPay(n)}function t(e,a){h?d("payCode",a.pay_url):d("payCodeImg",a.pay_url),p=a.pay_url}function o(){g.boxshadow.fadeOut(function(){showToast({text:"支付成功",bottom:"10%",zindex:9e3,speed:500,time:1500}),window.location.reload(),g.payCode.fadeOut(function(){window.location.reload()})})}function s(e){showToast({text:e.errorMessage,bottom:"10%",zindex:9e3,speed:500,time:1500})}function i(){h?g.payCode.find("#payCode").html(C):g.getPay.find("#payCodeImg").html(I)}function n(e,a){var t=Number(e)-Number(a);return t>0?t.toFixed(2):t<0?t.toFixed(2):t}function c(e){$.ajax({type:"GET",url:"https://mall.csdn.net/mp/mallorder/api/internal/goods/getGoodsInfo?goods_id="+e+"&product_id="+e+"&flag=17",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){u=t.data.available_amount,t.data.coupon_discount&&t.data.coupon_key&&(f=1*t.data.coupon_discount,m=t.data.coupon_key),O++,O<=1&&(0==u?(r=0,$(".pay-code-radio").prop("disabled",!0)):n(T,f)>0?(r=1,$(".pay-code-radio").attr("data-flag","true"),$(".pay-code-radio").prop("checked",!0)):(r=0,$(".pay-code-radio").prop("disabled",!0))),$(".pay-balance .balance").text(u),$(".pay-code-balance .balance").text(u),l(),a(e)}})}function l(){$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"block"}),f?(n(T,f)>0?r?(n(n(T,f),u)>0?($(".available-balance-0").text("¥"+u),$(".available-balance-1").text("¥"+n(n(T,f),u))):($(".available-balance-0").text("¥"+n(T,f)),$(".available-balance-1").text("¥0")),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".available-balance-1").text("¥"+n(T,f)),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".available-balance-1").text("¥0"),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})),$(".coupons-box .coupons-money").html("¥"+f),$(".coupons-box").fadeIn()):r?(n(T,u)>0?($(".available-balance-0").text("¥"+u),$(".available-balance-1").text("¥"+n(T,u))):($(".available-balance-0").text("¥"+T),$(".available-balance-1").text("¥0")),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".now-price").text("¥"+T),$(".subscribe-available-balance").css({display:"none"}),$(".subscribe-price-box").css({display:"block"}))}function d(e,a){var t=qrcode(6,"M");t.addData(a),t.make(),$("#"+e).html(t.createImgTag(3,3)),$("#"+e).html($("#"+e).html()),h&&g.boxshadow.fadeIn(function(){g.payCode.fadeIn()})}function b(){var e=$(this),a=e.data("id");if(e.data("type"))var t=blogUrl+"phoenix/web/v1/subscribe/un-subscribe-study?columnId="+a;else var t=blogUrl+"phoenix/web/v1/subscribe/subscribe-study?columnId="+a;getCookie("UserName")?$.ajax({url:t,type:"post",dataType:"json",xhrFields:{withCredentials:!0},success:function(a){200==a.code&&a.data.status?e.data("type")?($(".studyvip-unsubscribe").css("display","inline-block"),$(".studyvip-subscribe").css("display","none")):($(".studyvip-subscribe").css("display","inline-block"),$(".studyvip-unsubscribe").css("display","none")):showToast({text:a.data.msg||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})},error:function(e){showToast({text:e.data.msg||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})}}):window.csdn.loginBox.show()}var r=0,u=0,p="",m="",f=0;$(document).on("click",".tip-subscribe-column>span",function(){$(this).parent().find(".tip").fadeIn()}),$(document).on("click",".tip-subscribe-column .bt-close",function(){$(".tip-subscribe-column").find(".tip").fadeOut()});var y="",g={boxshadow:$(".skin-boxshadow"),btClose:$(".bt-close"),payCode:$(".pay-code"),btSubscribe:$(".bt-subscribe-article"),btSubscribeColumn:$(".bt-subscribe-text"),getPay:$(".get-pay")},h=!1,v=window.location.href;v.indexOf("category_")>-1&&!h&&getCookie("UserName")&&g.getPay.length&&(y=g.getPay.data("id"),c(y)),$(document).on("click",".bt-subscribe",function(){getCookie("UserName")||window.csdn.loginBox.show()}),g.getPay.on("click",function(){h=!1,y=$(this).data("id"),a(y)}),g.payCode.on("click",".renovate",function(){a(y||$(this).parent().data("id"))}),g.btClose.on("click",function(){g.payCode.fadeOut(function(){g.boxshadow.fadeOut()})});var x=blogStaticHost+"dist/pc/img/pay-time-out.png",w="获取中",_='<img class="repeat-again" src="'+x+'"><span class="text">'+w+"</span>",k='<div class="renov-men"><img src="'+x+'"><span>'+w+"</span></div>",C='<div class="renovate">    <img src="'+blogStaticHost+'dist/pc/img/pay-time-out.png">    <span>点击重新获取</span></div>',I='<img class="repeat-again" src="'+blogStaticHost+'dist/pc/img/pay-time-out.png"><span class="text">点击重新获取</span>';$(".now-price").text();$(".pay-code-radio").click(function(){var e=$(this).attr("data-flag");"true"==e?(r=0,$(this).attr("data-flag","false"),$(this).prop("checked",!1)):(r=1,$(this).attr("data-flag","true"),$(this).prop("checked",!0)),c(y)});var T=$(".subscribe-price .now-price").text().slice(1),O=0;g.payCode.on("click",".blance-bt",function(){window.open(p)}),$(document).on("click",".articleColumnBt",function(){if(getCookie("UserName")){if(window.csdn&&window.csdn.userOrderPayment){var e=$(this).data("id");window.csdn.userOrderPayment.show({goods_id:e,product_id:e,flag:17})}}else window.csdn.loginBox.show()}),$(document).on("click",".column-studyvip-pass",function(){getCookie("UserName")?window.open("https://vip.csdn.net/studyvip?utm_source=zhuanlan"):window.csdn.loginBox.show()}),$(document).on("click",".column-studyvip-ajax",b)});